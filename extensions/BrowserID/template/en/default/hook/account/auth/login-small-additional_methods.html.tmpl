[% IF Param('user_info_class').split(',').contains('BrowserID') %]
<script src="https://browserid.org/include.js" type="text/javascript"></script>

<script type="text/javascript">
function browserid_sign_in() {
    navigator.id.getVerifiedEmail(function(assertion) {
        if (assertion) {
            // This code will be invoked once the user has successfully
            // selected an email address they control to sign in with.
            var browseridForm = document.createElement('form');
            browseridForm.action = '[% login_target FILTER js %]';
            browseridForm.method = 'POST';
            browseridForm.style.display = 'none';
            
            var tokenField = document.createElement('input');
            tokenField.type = 'hidden';
            tokenField.name = 'token';
            tokenField.value = '[% issue_hash_token(['login']) FILTER js %]';
            browseridForm.appendChild(tokenField);

            var assertionField = document.createElement('input');
            assertionField.type = 'hidden';
            assertionField.name = 'browserid_assertion';
            assertionField.value = assertion;
            browseridForm.appendChild(assertionField);

            document.body.appendChild(browseridForm);
            browseridForm.submit();
            return true;
        }
    });
}
YAHOO.util.Event.addListener('login_link[% qs_suffix FILTER js %]','click', function () {
    var login_link = YAHOO.util.Dom.get('browserid_mini_login[% qs_suffix FILTER js %]');
    YAHOO.util.Dom.removeClass(login_link, 'bz_default_hidden');
});
YAHOO.util.Event.addListener('hide_mini_login[% qs_suffix FILTER js %]','click', function () {
    var login_link = YAHOO.util.Dom.get('browserid_mini_login[% qs_suffix FILTER js %]');
    YAHOO.util.Dom.addClass(login_link, 'bz_default_hidden');
});
</script>

<span id="browserid_mini_login[% qs_suffix FILTER html %]" class="bz_default_hidden">
  <img src="extensions/BrowserID/web/sign_in_orange.png" onclick="browserid_sign_in()" style="margin-bottom: -8px"> or
</span>
[% END %]
